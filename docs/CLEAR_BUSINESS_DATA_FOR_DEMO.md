# Очистка бизнес-данных перед демо/обучением

Скрипт подготавливает сайт к наполнению с нуля: удаляет все «рабочие» данные, **сохраняя справочники**.

## Что сохраняется (справочники)

- Сотрудники (User), роли (Role), отделы (Department)
- Юрлица (LegalEntity)
- Продукты (Product), ниши (Niche)
- Категории и статьи расходов (CostCategory, CostItem, FinancialModelExpenseType)
- Агенты (Agent)

## Что удаляется

- Клиенты (кроме системного «Без клиентов»), контакты (Contact), привязки (ClientContact)
- Сайты (Site), услуги (Service)
- Рабочие периоды (WorkPeriod), отчёты по периодам (WorkPeriodReport)
- Счета (Invoice), строки счетов (InvoiceLine), платежи (Payment)
- Пометки «счёт выставлен» (PeriodInvoiceNote)
- Закрывающие пакеты и документы (CloseoutPackage, CloseoutDocument)
- Договора (ContractDocument, ContractSection)
- Доходы (Income), расходы (Expense)
- Доступ в клиентский портал (ClientPortalAccess)

После очистки автоматически создаётся/обновляется системный клиент **«Без клиентов»** (нужен для выбора в формах).

## Запуск

**Локально:**

```bash
npm run db:clear-business
# или
npx tsx scripts/clear-business-data.ts
```

**На сервере** (после деплоя, с подключением к БД сервера):

```bash
cd /path/to/agency-finance
npx tsx scripts/clear-business-data.ts
```

Перед запуском на продакшене сделайте бэкап БД (см. `docs/BACKUP_SERVER_DB.md`).

## Проверка

После запуска:

1. Запустите приложение, откройте разделы: клиенты, счета, периоды, сайты, услуги, доходы, расходы, договора, закрывающие документы — списки должны быть пустыми (у клиентов только «Без клиентов»).
2. Справочники (сотрудники, юрлица, продукты, статьи расходов и т.д.) должны быть на месте, без ошибок 500.
