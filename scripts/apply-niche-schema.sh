#!/bin/bash
set -e

echo "=========================================="
echo "üîß –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –°–•–ï–ú–´ –ë–î –î–õ–Ø –ù–ò–®"
echo "=========================================="
echo ""

cd /var/www/agency-finance || exit 1

echo "1Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ–∫—É—â–µ–π —Å—Ö–µ–º—ã –ë–î..."
echo "----------------------------"
npx prisma db pull --print 2>&1 | grep -i "niche" || echo "‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ Niche –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –≤ –ë–î"
echo ""

echo "2Ô∏è‚É£ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π —Å—Ö–µ–º—ã (—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã Niche)..."
echo "----------------------------"
echo "‚ö†Ô∏è  –≠—Ç–æ –±–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è - —Å–æ–∑–¥–∞—Å—Ç—Å—è —Ç–æ–ª—å–∫–æ –Ω–æ–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ Niche"
echo "‚ö†Ô∏è  –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –±—É–¥—É—Ç –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã"
echo ""

npx prisma db push --skip-generate --accept-data-loss 2>&1 | head -50

echo ""
echo "3Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞..."
echo "----------------------------"
npx prisma db pull --print 2>&1 | grep -i "model Niche" && echo "‚úÖ –¢–∞–±–ª–∏—Ü–∞ Niche —Å–æ–∑–¥–∞–Ω–∞" || echo "‚ö†Ô∏è –¢–∞–±–ª–∏—Ü–∞ Niche –Ω–µ –Ω–∞–π–¥–µ–Ω–∞"
echo ""

echo "4Ô∏è‚É£ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
pm2 restart agency-finance --update-env
sleep 5
pm2 status
echo ""

echo "=========================================="
echo "‚úÖ –ü–†–ò–ú–ï–ù–ï–ù–ò–ï –°–•–ï–ú–´ –ó–ê–í–ï–†–®–ï–ù–û"
echo "=========================================="
